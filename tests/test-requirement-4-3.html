<!DOCTYPE html>
<html>
<head>
    <title>Requirement 4.3 Test - Empty Log History</title>
    <style>
        body { font-family: Arial, sans-serif; background: #1a1a1a; color: white; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: rgba(76, 175, 80, 0.2); color: #4caf50; }
        .error { background: rgba(244, 67, 54, 0.2); color: #f44336; }
        .info { background: rgba(74, 144, 226, 0.2); color: #4a90e2; }
    </style>
</head>
<body>
    <h1>Requirement 4.3 Test</h1>
    <p><strong>Requirement 4.3:</strong> "WHEN the userscript is reloaded THEN the system SHALL start with an empty log history"</p>
    <div id="test-results"></div>
    
    <script src="infinite-craft-helper.user.js"></script>
    <script>
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = 'test ' + type;
            const icon = type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️';
            div.textContent = `${icon} ${message}`;
            document.getElementById('test-results').appendChild(div);
        }

        // Test at different intervals to see the cleanup process
        addResult('Starting Requirement 4.3 test...', 'info');

        // Test immediately (should have initialization logs)
        setTimeout(() => {
            if (window.logManager) {
                const count = window.logManager.getLogCount();
                addResult(`Immediate check: ${count} logs (initialization logs present)`, 'info');
            }
        }, 50);

        // Test after cleanup should complete (should be empty)
        setTimeout(() => {
            if (window.logManager) {
                const count = window.logManager.getLogCount();
                if (count === 0) {
                    addResult('REQUIREMENT 4.3 PASSED: System starts with empty log history', 'success');
                } else {
                    addResult(`REQUIREMENT 4.3 FAILED: Expected 0 logs, found ${count}`, 'error');
                    
                    // Show what logs are present
                    const logs = window.logManager.getLogs();
                    logs.forEach((log, index) => {
                        addResult(`Log ${index + 1}: [${log.level}] ${log.message}`, 'info');
                    });
                }

                // Test that logging still works after cleanup
                window.Logger.log('Test message after cleanup');
                
                setTimeout(() => {
                    const newCount = window.logManager.getLogCount();
                    if (newCount === 1) {
                        addResult('Logger API works correctly after cleanup', 'success');
                    } else {
                        addResult(`Logger API issue: Expected 1 log after test, got ${newCount}`, 'error');
                    }
                }, 50);
            } else {
                addResult('LogManager not available for testing', 'error');
            }
        }, 200);
    </script>
</body>
</html>